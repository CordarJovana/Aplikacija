<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" 
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" 
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" 
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" 
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script> 
    <link rel="stylesheet" href="../styles.css">
    <title>BOLNICA H&H</title>
</head>
<body id="pacijenti">

    <!-- NavBar -->

    <nav class="navbar navbar-expand-md navbar-light bg-light sticky-top">
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="index.html">Početna</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="pacijenti.html">Pacijenti</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="doktori.html">Doktori</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#">Pregledi</a>
              </li>
            </ul>
        </div>
    </nav>

    
<!-- Tabela Pacijenata-->
<div class="container-fluid padding">
      <div class="row welcome text-center">
        <div class="col-12">
          <div class="table">
            <h1 class="my-3">Doktori</h1>
            <table id="users-table" class="table">
              <thead>
                    <tr>
                      <th scope="col">Doktor ID</th>
                      <th scope="col">Ime</th>
                      <th scope="col">Prezime</th>
                      <th scope="col">JMBG</th>
                      <th scope="col">Specijalista</th>
                    </tr>
                  </thead>
                    <tbody id="doktori_podaci"></tbody>
                </table>
              </div>
        

<!-- Forma za unos novog pacijenta-->
              <form id="dodaj_doktora">
                <div class="form-inline">
                  <input type="text" class="form-control m-2" name="title" id="ime_doktora" 
                  placeholder="Unesite ime" value="" required>
                  <input type="text" class="form-control m-2" name="author" id="prezime_doktora" 
                  placeholder="Unesite prezime" value="" required>
                  <input type="text" class="form-control m-2" name="year" id="jmbg_doktora" 
                  placeholder="Unesite JMBG" value="" required>
                  <div class="form-group">
                <select class="form-control" id="kategorija_doktora">
                    </select>
                </div>
                </div>
                <div class="form-group m-2">
                  <button type="submit" name="submit" id="dodaj_doktora" class="btn btn-success" onclick="kreirajDoktora()">Sačuvaj</button>
                </div>
              </form>     
            </div>
          </div>
    </div>

    
  </body>
  </html>

<script>
      
//Za dobijanje svih doktora i punjenje tabele i punjenje kategorija
$(document).ready(function () {
  tabelaDoktora();
  tabelaKategorija("kategorija_doktora");
  });

function tabelaDoktora() {
   $.getJSON("doktori.php", { metoda: "vrati sve" }, function (data) {
                console.log(data);
                if (data.status !== "ok") {
                    alert(data.status);
                    return;
                }
                let i = 0;
                $("#doktori_podaci").html("");
                for (let doktor of data.data) {
                    $("#doktori_podaci").append(`<tr>  
                    <th scope="row">${++i}.</th>
                    <td contentEditable=true id="${doktor.id}Ime">${doktor.ime} </td>
                    <td contentEditable=true id="${doktor.id}Prezime"> ${doktor.prezime}</td>
                    <td contentEditable=true id="${doktor.id}JMBG">${doktor.jmbg} </td>
                    <td contentEditable=true ><select class="form-control" id="${doktor.id}Kat"></td>
                    <td>
                        <button class="btn btn-primary izmeni-doktora" onClick="izmeniDoktora(${doktor.id})">Izmeni</button>
                        <button class="btn btn-danger obriši-doktora" onClick="obrisiDoktora(${doktor.id})">Obriši</button>
                      </td>
                </tr>`);
                tabelaKategorija(`${doktor.id}Kat`, doktor.idkategorije);
                }
            });

        }

function tabelaKategorija(element, value=undefined) {
            $.getJSON("doktori.php", { metoda: "vrati kategorije" }, function (data) {
                if (data.status !== "ok") {
                    alert(data.status);
                    return;
                }
                $("#" + element).html(``);

                for (let kat of data.data) {
                    $("#" + element).append(`<option value='${kat.id}' > ${kat.naziv} </option>`);
                }
                if (value) {
                    $("#" + element).val(value);
                }
            })
        }

//Kreiranje novog pacijenta
function kreirajDoktora(){
                $.post("doktori.php", {
                    metoda: "dodaj",
                    ime: $("#ime_doktora").val(),
                    prezime: $("#prezime_doktora").val(),
                    jmbg: $("#jmbg_doktora").val(),
                    idkategorije: $("#kategorija_doktora").val()
                }, function (data) {
                    alert(data);
                    tabelaDoktora();

                })
            
}

//Brisanje pacijenta
function obrisiDoktora(id) {
  $.post("doktori.php", { metoda: "obrisi", id: id }, function (data) {
                tabelaDoktora();
            })
        }

//Izmena pacijenta
function izmeniDoktora(id) {
            let ime = $(`#${id}Ime`).text();
            let prezime = $(`#${id}Prezime`).text();
            let jmbg = $(`#${id}JMBG`).text();
            let idkategorije = $(`#${id}Kat`).val();

            $.post("doktori.php", {
                metoda: "izmeni",
                id: id,
                ime: ime,
                prezime: prezime,
                jmbg: jmbg,
                idkategorije: idkategorije
            }, function (data) {
                tabelaDoktori();
            })
        }
      
    // AJAX Add              
    /*$(function() {
      $("#dodaj_pacijenta").click(function(event) {
       event.preventDefault();
         let title = $('#title_textfiled').val();
         let author = $('#author_textfiled').val();
         let year = $('#year_textfiled').val();
         $.ajax({
           type: "POST",
           url: "pacijenti.php",
           data: {

             "add": title,
             "author" : author,
             "year" : year
           },
           success: function() {
             alert('Book added');
             location.reload();
           }
         });
       });
    });

    // AJAX Delete
    $(function() {
      $('.delete-book').click(function() {
        let bookId = $(this).parent().parent().data('id');
        $.ajax({
          url: '../handler/bookHandler.php',
          data: {
            "delete": bookId
          },
          type: 'POST',
          success: function() {
            alert('Book deleted');
            location.reload();
          }
        });
      });
    });

    // AJAX On edit Click
    $(function() {
      $('.edit-book').click(function() {
        let userId = $(this).parent().parent().data('id');
        $.ajax({
          url: '../handler/userHandler.php',
          data: {
            "edit": userId
          },
          type: 'POST',
          dataType: "json",
          success: function(data) {
            alert('User deleted');
            console.log(data);
            console.log(data["name"]);
            $('#title_textfiled').val(data["name"]);
            $('#add_book_button').hide();
            $('#update_book_button').show();
            $('#update_book_button').attr('data-id', data["id"]);
          }
        });
      });
    });
*/

    </script>

